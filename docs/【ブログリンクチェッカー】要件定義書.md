## ブログ記事リンクチェッカー自動化プロジェクト 要件定義書 Ver. 3.0

### 1. プロジェクト概要

#### 1.1. 背景と課題
現在、複数人で運営しているブログサイトの記事品質を維持するため、記事内に含まれるハイパーリンクが有効であるか（リンク切れがないか）を定期的に確認する必要がある。しかし、この確認作業は手動で行われており、以下の課題を抱えている。
*   **作業負荷の増大:** 記事数やリンク数の増加に伴い、確認作業に多くの時間と手間を要している。
*   **確認漏れの発生:** 手動による作業のため、ヒューマンエラーによる確認漏れや見落としが発生するリスクがある。
*   **問題発見の遅れ:** 定期的なチェックが負担となり、リンク切れの発見が遅れ、サイト訪問者の体験を損なう可能性がある。

#### 1.2. プロジェクトの目的とゴール

本プロジェクトは、上記課題を解決するため、ブログ記事内のリンクチェック作業を自動化するツールを開発することを目的とする。

これにより、以下のゴール達成を目指す。
*   **ゴール1:** リンクチェックに関わる作業時間を削減する。
*   **ゴール2:** 機械的なチェックにより、ヒューマンエラーを撲滅し、チェックの網羅性を担保する。
*   **ゴール3:** 定期的な自動実行により、リンク切れの早期発見と迅速な報告を可能にする。

#### 1.3. プロジェクトスコープ（範囲）
*   **対象範囲**
    *   チェック対象のURLリストはGoogleスプレッドシートで管理する。
    *   ブログ記事によってHTML構成が異なる場合に対応するため、自動抽出とは別に、手動でチェック対象のリンクを追記できる仕組みを持つ。
    *   初期開発時点での対象ブログプラットフォームは、「はてなブログ」および「ライブドアブログ」とする。
    *   静的なHTMLに記述されたリンクをチェック対象とする。
    *   リンク切れの検知に加え、前回チェック時からの差分（新規エラー、修正済み箇所）を検出し報告する。

*   **対象外範囲**
    *   JavaScriptによって動的にレンダリングされるリンクの抽出。
    *   リンク先のページのコンテンツ内容の正当性チェック。
    *   本ツール自体に、リンクを自動修正する機能は持たせない。

### 2. システム構成
本システムは、データ準備、リンクチェック、結果反映の各処理を非同期に連携させる構成とする。

### 3. 機能要件

#### 3.1. データ準備機能
*   原本スプレッドシートから最新のチェック対象URLリストを取得し、作業用スプレッドシートに転記する機能。
*   転記したURLリストの件数を前回実行時と比較し、変動があった場合に管理者にメールで通知する機能。
*   最新のURLリストを、後続のリンクチェック処理で利用可能なデータ形式で出力する機能。

#### 3.2. リンクチェック機能
*   データ準備機能によって出力されたデータをトリガーに起動する機能。
*   入力されたデータを解析し、チェック対象URLリストを取得する機能。
*   各URLのHTMLコンテンツを取得し、チェック対象となるリンクを抽出する機能。
*   抽出したリンクの有効性を検証する機能。
*   全てのチェック結果に実行タイムスタンプを付与し、一つの結果ファイルとして出力する機能。
*   処理中に発生した致命的なエラーを検知し、管理者に通知する機能。

#### 3.3. 結果反映・差分比較機能
*   リンクチェック機能が出力した結果ファイルを読み込む機能。
*   結果ファイル内のタイムスタンプを検証し、処理の整合性を確認する機能。異常時は管理者にメールで通知し処理を中断する。
*   スプレッドシート内で「当日シート」と「前日シート」を管理し、チェック結果を反映する前にシート間でデータを移行する機能。
*   最新のチェック結果を「当日シート」に書き込む機能。
*   「当日シート」と「前日シート」のデータを比較し、以下の差分を検出する機能。
    *   **新規データ:** 前日にはなく、当日に存在するデータ。
    *   **変更データ:** キーは同じだが、ステータスなどが変更されたデータ。
    *   **削除データ:** 前日にはあったが、当日に存在しないデータ。
*   検出した差分に基づき、「当日シート」の表示を書式設定により視覚的に分かりやすく加工する機能。

#### 3.4. 報告・履歴保管機能
*   処理の完了を管理者にメールで通知する機能。
*   差分比較の結果、変更点があった場合はその内容を整形し、メール本文に含めて報告する機能。
*   日々の実行結果を永続的に保管するため、「当日シート」を複製・バックアップする機能。
*   指定した日数を超えた古いバックアップシートを自動で削除する機能。

### 4. 非機能要件

| 項目 | 要件 |
| :--- | :--- |
| **性能** | チェック対象が100～200件の場合、全体の処理が15分以内に完了すること。 |
| **可用性・信頼性** | 1. システムの各処理は、毎日定時に自動実行されること。 2. リンクチェック処理における外部への接続失敗時には、指定回数のリトライ処理を行うこと。 3. 処理の途中で予期せぬエラーが発生した場合、エラー内容を記録し、管理者にエラー通知を行う仕組みを持つこと。 |
| **トリガー**| 1. 定時（時間ベース）での実行が可能であること。 2. 特定のイベント（ファイルの作成など）をきっかけに処理を開始できること。 |
| **セキュリティ** | 1. 外部サービスへの認証情報は、ソースコードとは分離し、安全な方法で管理すること。 2. 各コンポーネントには、処理に必要な最小限の権限のみを付与すること。 3. システムが利用するデータ保管場所は、原則として非公開設定とすること。 |
| **保守性・運用** | 1. 各種設定値（ID、通知先、しきい値など）は、コード内に直接記述せず、外部から設定・変更が可能であること。 2. 処理の実行ログは集約管理し、後から追跡可能であること。 |

### 5. 前提・制約事項
*   本プロジェクトで採用する技術スタック（Google Apps Script, AWS Lambda, Amazon S3等）で実現可能であることを前提とする。
*   Googleスプレッドシートは、「原本リスト用」と「結果を管理する作業用」の2種類を用意する。